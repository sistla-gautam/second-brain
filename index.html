<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Repo Browser</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.2.12/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
  <style>
    /* Previous styles remain the same */
    /* Adding styles for PDF viewer */
    .pdf-container {
      width: 100%;
      height: 800px;
      border: 1px solid var(--border-color);
      border-radius: 0 0 6px 6px;
    }

    .pdf-viewer {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <!-- Previous HTML remains the same -->
  <script>
    // Previous JavaScript remains the same until viewFile function

    async function viewFile(filePath) {
      const fileContents = document.getElementById('file-contents');
      fileContents.innerHTML = '<div class="loading">Loading file contents...</div>';
      
      const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filePath}?ref=${branch}`;
      try {
        const response = await fetch(apiUrl);
        if (response.ok) {
          const fileData = await response.json();
          const isPdf = filePath.toLowerCase().endsWith('.pdf');
          
          if (isPdf) {
            // For PDFs, we need to create a blob and object URL
            const byteCharacters = atob(fileData.content.replace(/\n/g, ''));
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
              byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: 'application/pdf' });
            const pdfUrl = URL.createObjectURL(blob);
            displayFileContents(filePath, pdfUrl, true);
          } else {
            // Handle other file types as before
            const decodedContent = atob(fileData.content.replace(/\n/g, ''));
            displayFileContents(filePath, decodedContent, false);
          }
        } else {
          throw new Error('Failed to load file');
        }
      } catch (error) {
        fileContents.innerHTML = '<div class="error">Error loading file contents.</div>';
      }
    }

    function displayFileContents(filePath, content, isPdf) {
      const fileContentsDiv = document.getElementById('file-contents');
      let html = `<div class="file-header">${filePath}</div>`;
      
      if (isPdf) {
        html += `
          <div class="pdf-container">
            <iframe 
              class="pdf-viewer" 
              src="${content}#toolbar=1&navpanes=1" 
              type="application/pdf"
            ></iframe>
          </div>`;
        
        // Clean up the object URL when the content changes
        const cleanup = () => {
          URL.revokeObjectURL(content);
          fileContentsDiv.removeEventListener('DOMNodeRemoved', cleanup);
        };
        fileContentsDiv.addEventListener('DOMNodeRemoved', cleanup);
      } else {
        const isMarkdown = filePath.toLowerCase().endsWith('.md');
        if (isMarkdown) {
          const renderedContent = marked.parse(content);
          html += `<div class="markdown-body">${renderedContent}</div>`;
        } else {
          html += `<pre><code>${escapeHtml(content)}</code></pre>`;
        }
      }
      
      fileContentsDiv.innerHTML = html;
    }

    // Rest of the JavaScript remains the same
  </script>
</body>
</html>
